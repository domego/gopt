// generated by ginpt
package {{underline .DBName}}

import (
  "database/sql"
  "time"
  "fmt"
  "bytes"

  "github.com/xiaoenai/gorp"
  "github.com/lenbo-ma/ginkit/db"
  "github.com/lenbo-ma/gokits"
)

var _ = time.Now
var _ = fmt.Println
var _ = sql.ErrNoRows
var _ = bytes.NewBuffer
var _ = utils.Int32

type {{upperCamel .TableName}} struct {
  {{ range $i, $v := .Columns }}
  {{upperCamel $v.Field}} {{$v.GoType}} `db:"{{$v.Field}}" json:"{{$v.Field}}"` {{end}}

  _db *db.DBInfo     `db:"-"`
  _tx *db.Transaction  `db:"-"`
}

func New{{upperCamel .TableName}}() *{{upperCamel .TableName}} {
  obj := New{{upperCamel .TableName}}WithoutDB()
  obj.SetDBInfo()
  return obj
}

func New{{upperCamel .TableName}}WithoutDB() *{{upperCamel .TableName}} {
  obj := &{{upperCamel .TableName}}{
    {{range .Columns}}
      {{if .Default }}
        {{setDefault . }}
      {{end}}
    {{end}}
  }
  return obj
}

func (obj *{{upperCamel .TableName}}) SetDBInfo() {
  database := GetDB()
  obj._db = &db.DBInfo {
    DB: database.DB,
    DbMap: database.DbMap,
  }
}

func (obj *{{upperCamel .TableName}}) SetTransaction(tx *db.Transaction) {
  obj._tx = tx
}

func (obj *{{upperCamel .TableName}}) GetSqlExecutor() gorp.SqlExecutor {
  if obj._tx != nil {
    return obj._tx
  }
  return obj._db
}

func (obj *{{upperCamel .TableName}}) Insert() {
  database := obj.GetSqlExecutor()
  {{ range .Columns }}
    {{ if eq .Field "created_at" }}
      {{ if eq .Null "YES"}}
        {{if eq .GoType "int32" }}
          obj.{{upperCamel .Field}} = int32(utils.GetUTCTime().Unix())
        {{else}}
          obj.{{upperCamel .Field}} = utils.GetLocalTime()
        {{end}}
      {{else}}
        {{if eq .GoType "int32" }}
          obj.{{upperCamel .Field}} = int32(utils.GetUTCTime().Unix())
        {{else}}
          obj.{{upperCamel .Field}} = time.Now()
        {{end}}
      {{end}}
    {{end}}
    {{ if eq .Field "updated_at" }}
      {{ if eq .Null "YES"}}
        {{if eq .GoType "int32" }}
          obj.{{upperCamel .Field}} = int32(utils.GetUTCTime().Unix())
        {{else}}
          obj.{{upperCamel .Field}} = utils.GetLocalTime()
        {{end}}
      {{else}}
        {{if eq .GoType "int32" }}
          obj.{{upperCamel .Field}} = int32(utils.GetUTCTime().Unix())
        {{else}}
          obj.{{upperCamel .Field}} = time.Now()
        {{end}}
      {{end}}
    {{end}}
  {{end}}
  err := database.Insert(obj)
  if err != nil {
    panic(err)
  }
}
